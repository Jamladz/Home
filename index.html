<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TonQash - TON Wallet</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #0088cc;
            --primary-dark: #0077b3;
            --secondary: #1e1e1e;
            --background: #121212;
            --card-bg: #1e1e1e;
            --text: #ffffff;
            --text-secondary: #b0b0b0;
            --success: #00c853;
            --warning: #ff9800;
            --danger: #f44336;
            --tqh-color: #9c27b0;
            --ton-color: #0098EA;
            --border-radius: 16px;
        }

        body {
            background: linear-gradient(135deg, var(--background), #0a0a0a);
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            padding-bottom: 100px;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        /* Header Styles */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            margin-bottom: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), #006699);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            overflow: hidden;
        }

        .logo-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .logo-text {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary), #00ccff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .user-actions {
            display: flex;
            gap: 15px;
        }

        .action-btn {
            background: rgba(255, 255, 255, 0.1);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }

        /* Balance Card */
        .balance-card {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        .balance-card::before {
            content: "";
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 70%);
            z-index: 0;
        }

        .balance-label {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }

        .balance-amount {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 5px;
            position: relative;
            z-index: 1;
        }

        .balance-value {
            font-size: 18px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        /* Currency Tabs */
        .currency-tabs {
            display: flex;
            background: var(--card-bg);
            border-radius: 50px;
            padding: 5px;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .tab.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        }

        /* Price Tickers */
        .price-tickers {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }

        .price-ticker {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 15px;
            flex: 1;
            display: flex;
            flex-direction: column;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .ticker-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .coin-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            background-size: cover;
            background-position: center;
        }

        .ton-icon {
            background-color: var(--ton-color);
            background-image: url('https://ton.org/download/ton_symbol.png');
        }

        .tqh-icon {
            background-color: var(--tqh-color);
            background-image: url('https://i.suar.me/vpO26/l');
        }

        .coin-name {
            font-weight: 600;
            font-size: 16px;
        }

        .price-info {
            display: flex;
            flex-direction: column;
        }

        .coin-price {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .price-change {
            font-size: 14px;
            font-weight: 600;
        }

        .positive {
            color: var(--success);
        }

        .negative {
            color: var(--danger);
        }

        /* Quick Actions */
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin: 25px 0 15px 0;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .action-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 18px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .action-card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .action-card.disabled::after {
            content: "Coming Soon";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
        }

        .action-card:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.05);
        }

        .action-icon {
            font-size: 24px;
            margin-bottom: 12px;
            color: var(--primary);
        }

        .action-text {
            font-size: 14px;
            opacity: 0.9;
        }

        /* Transactions */
        .transactions {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .transaction {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .transaction:last-child {
            border-bottom: none;
        }

        .transaction-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: rgba(0, 136, 204, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            margin-left: 15px;
            color: var(--primary);
        }

        .transaction-details {
            flex: 1;
        }

        .transaction-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .transaction-date {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .transaction-amount {
            font-weight: 700;
        }

        .receive {
            color: var(--success);
        }

        .send {
            color: var(--danger);
        }

        .task {
            color: var(--tqh-color);
        }

        /* Action Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 400px;
            padding: 25px;
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text);
            font-size: 24px;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            opacity: 0.8;
        }

        .form-input {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.07);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: var(--text);
            font-size: 16px;
        }

        .form-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .form-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 136, 204, 0.3);
        }

        /* Tasks Section */
        .tasks-container {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .task-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .task-item:last-child {
            border-bottom: none;
        }

        .task-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: rgba(156, 39, 176, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            margin-left: 15px;
            color: var(--tqh-color);
        }

        .task-details {
            flex: 1;
        }

        .task-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .task-description {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .task-reward {
            font-size: 14px;
            color: var(--tqh-color);
            font-weight: 600;
        }

        .task-btn {
            padding: 8px 15px;
            background: rgba(156, 39, 176, 0.2);
            border: none;
            border-radius: 20px;
            color: var(--tqh-color);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .task-btn:hover {
            background: rgba(156, 39, 176, 0.3);
        }

        .task-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .timer-text {
            font-size: 12px;
            color: var(--warning);
            margin-top: 5px;
        }

        /* Account Section */
        .account-container {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--tqh-color));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .user-id {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .account-info {
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-top: 20px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .info-item:last-child {
            border-bottom: none;
        }

        .info-label {
            color: var(--text-secondary);
        }

        .info-value {
            font-weight: 600;
        }

        .referral-section {
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius);
            padding: 20px;
        }

        .referral-status {
            text-align: center;
            margin-top: 15px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Wallet Connect Button */
        #ton-connect {
            margin-top: 20px;
            border-radius: 10px;
            overflow: hidden;
        }

        #ton-connect-main {
            margin: 20px 0;
        }

        .wallet-connected {
            width: 100%;
            padding: 12px;
            background: var(--success);
            color: white;
            border-radius: 10px;
            text-align: center;
            font-weight: 600;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--card-bg);
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            z-index: 100;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            opacity: 0.7;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-item.active {
            opacity: 1;
            color: var(--primary);
        }

        .nav-item i {
            font-size: 20px;
        }

        .nav-item:hover {
            opacity: 1;
        }

        /* Animations */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.03); }
            100% { transform: scale(1); }
        }

        .balance-card {
            animation: pulse 4s infinite ease-in-out;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Ad Container */
        .ad-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            padding: 20px;
            text-align: center;
        }

        .ad-content {
            max-width: 400px;
            width: 100%;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            position: relative;
        }

        .ad-close {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--danger);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
        }

        .ad-title {
            font-size: 20px;
            margin: 20px 0;
            color: var(--primary);
        }

        .ad-description {
            margin-bottom: 20px;
            color: var(--text-secondary);
        }

        .ad-countdown {
            font-size: 24px;
            font-weight: 700;
            margin: 20px 0;
            color: var(--warning);
        }

        .ad-reward {
            background: rgba(0, 200, 83, 0.2);
            padding: 10px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: 600;
        }

        /* Loading Spinner */
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 500px) {
            .balance-amount {
                font-size: 32px;
            }
            
            .quick-actions {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .action-card {
                padding: 15px 5px;
            }
            
            .action-icon {
                font-size: 20px;
            }
            
            .price-tickers {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="logo">
                <div class="logo-img">
                    <img src="https://i.suar.me/rplEz/l" alt="TonQash Logo">
                </div>
                <div class="logo-text">TonQash</div>
            </div>
            <div class="user-actions">
                <div class="action-btn">
                    <i class="fas fa-bell"></i>
                </div>
                <div class="action-btn">
                    <i class="fas fa-cog"></i>
                </div>
            </div>
        </div>

        <!-- Currency Tabs -->
        <div class="currency-tabs">
            <div class="tab active" data-currency="ton">TON</div>
            <div class="tab" data-currency="tqh">TQH</div>
        </div>

        <!-- Balance Card -->
        <div class="balance-card">
            <div class="balance-label">Your Wallet Balance</div>
            <div class="balance-amount"><span id="balance-amount">0.00</span> <span id="balance-currency">TON</span></div>
            <div class="balance-value">≈ $<span id="balance-value">0.00</span> USD</div>
        </div>

        <!-- Wallet Connect Button (Main Page) -->
        <div id="ton-connect-main"></div>

        <!-- Price Tickers -->
        <div class="price-tickers">
            <div class="price-ticker">
                <div class="ticker-header">
                    <div class="coin-icon ton-icon"></div>
                    <div class="coin-name">TON</div>
                </div>
                <div class="price-info">
                    <div class="coin-price">$<span id="ton-price">3.10</span></div>
                    <div class="price-change positive">+<span id="ton-change">1.2</span>%</div>
                </div>
            </div>
            <div class="price-ticker">
                <div class="ticker-header">
                    <div class="coin-icon tqh-icon"></div>
                    <div class="coin-name">TQH</div>
                </div>
                <div class="price-info">
                    <div class="coin-price">$<span id="tqh-price">0.25</span></div>
                    <div class="price-change positive">+<span id="tqh-change">0.8</span>%</div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="section-title">Quick Actions</div>
        <div class="quick-actions">
            <div class="action-card disabled">
                <div class="action-icon">
                    <i class="fas fa-paper-plane"></i>
                </div>
                <div class="action-text">Send</div>
            </div>
            <div class="action-card disabled">
                <div class="action-icon">
                    <i class="fas fa-qrcode"></i>
                </div>
                <div class="action-text">Receive</div>
            </div>
            <div class="action-card disabled">
                <div class="action-icon">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="action-text">Buy</div>
            </div>
            <div class="action-card disabled">
                <div class="action-icon">
                    <i class="fas fa-exchange-alt"></i>
                </div>
                <div class="action-text">Convert</div>
            </div>
        </div>

        <!-- Recent Transactions -->
        <div class="section-title">Recent Transactions</div>
        <div class="transactions" id="transactions-container">
            <div class="spinner" id="loading-spinner"></div>
            <div id="transactions-list"></div>
        </div>

        <!-- Tasks Section -->
        <div class="tasks-container" id="tasks-container">
            <div class="section-title">Available Tasks</div>
            
            <!-- Wallet Connect Task -->
            <div class="task-item" id="wallet-connect-task">
                <div class="task-icon">
                    <i class="fas fa-wallet"></i>
                </div>
                <div class="task-details">
                    <div class="task-title">Connect TON Wallet</div>
                    <div class="task-description">Connect your wallet to start earning rewards</div>
                    <div class="task-reward">Reward: 5 TQH</div>
                </div>
                <div id="ton-connect-tasks"></div>
            </div>
            
            <!-- Task 1: Daily Reward -->
            <div class="task-item">
                <div class="task-icon">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <div class="task-details">
                    <div class="task-title">Daily Check-in</div>
                    <div class="task-description">Pay 0.1 TON to receive 20 TQH</div>
                    <div class="task-reward">Reward: 20 TQH</div>
                    <div id="daily-timer" class="timer-text"></div>
                </div>
                <button class="task-btn" id="daily-reward-btn">Claim Reward</button>
            </div>
            
            <!-- Task 2: Watch Ad -->
            <div class="task-item">
                <div class="task-icon">
                    <i class="fas fa-ad"></i>
                </div>
                <div class="task-details">
                    <div class="task-title">Watch an Ad</div>
                    <div class="task-description">Watch an ad for 30 seconds to earn a reward</div>
                    <div class="task-reward">Reward: 1 TQH</div>
                    <div id="ad-timer" class="timer-text"></div>
                </div>
                <button class="task-btn" id="watch-ad-btn">Watch Now</button>
            </div>
        </div>
        
        <!-- Account Section -->
        <div class="account-container" id="account-container">
            <div class="section-title">Your Account</div>
            
            <div class="user-profile">
                <div class="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-info">
                    <div class="user-name" id="telegram-username">User</div>
                    <div class="user-id" id="telegram-userid">ID: 123456789</div>
                </div>
            </div>
            
            <!-- Wallet Connect Button (Account Page) -->
            <div id="ton-connect-account"></div>
            
            <div class="referral-section">
                <div class="section-title">Refer Friends</div>
                <div class="form-group">
                    <label class="form-label">Your Referral Link</label>
                    <input type="text" class="form-input" id="referral-link" readonly>
                </div>
                <button class="form-btn" id="copy-referral">Copy Link</button>
                <p class="referral-status" id="referral-status">Calculating...</p>
            </div>
            
            <div class="account-info">
                <div class="info-item">
                    <span class="info-label">Completed Tasks:</span>
                    <span class="info-value" id="completed-tasks">0</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Total Earnings:</span>
                    <span class="info-value" id="total-earnings">0.00 TQH</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Join Date:</span>
                    <span class="info-value" id="join-date">July 1, 2025</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Ad Container -->
    <div class="ad-container" id="ad-container">
        <div class="ad-content">
            <div class="ad-close" id="ad-close">✕</div>
            <div class="ad-title">Watch This Ad</div>
            <div class="ad-description">Please watch the full ad for 30 seconds to get your reward</div>
            
            <!-- Ad placeholder -->
            <div style="background: #333; height: 180px; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin: 20px 0;">
                <i class="fas fa-ad" style="font-size: 50px; color: #666;"></i>
            </div>
            
            <div class="ad-countdown" id="ad-countdown">30</div>
            <div class="ad-reward">You will receive 1 TQH after the ad ends</div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-item active" data-page="home">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </div>
        <div class="nav-item" data-page="wallet">
            <i class="fas fa-wallet"></i>
            <span>Wallet</span>
        </div>
        <div class="nav-item" data-page="tasks">
            <i class="fas fa-tasks"></i>
            <span>Tasks</span>
        </div>
        <div class="nav-item" data-page="account">
            <i class="fas fa-user"></i>
            <span>Account</span>
        </div>
    </div>

    <script>
        // State management
        const state = {
            tonBalance: 0.5,
            tqhBalance: 10,
            tonPrice: 3.10,
            tqhPrice: 0.25,
            transactions: [],
            lastAdTime: 0,
            lastDailyClaim: 0,
            walletConnected: false,
            completedTasks: 0,
            totalEarnings: 0,
            telegramUser: {
                id: 123456789,
                username: "telegram_user",
                firstName: "User",
                lastName: "Telegram"
            }
        };

        // DOM Elements
        const balanceAmountEl = document.getElementById('balance-amount');
        const balanceCurrencyEl = document.getElementById('balance-currency');
        const balanceValueEl = document.getElementById('balance-value');
        const transactionsContainer = document.getElementById('transactions-container');
        const transactionsList = document.getElementById('transactions-list');
        const loadingSpinner = document.getElementById('loading-spinner');
        const tasksContainer = document.getElementById('tasks-container');
        const accountContainer = document.getElementById('account-container');
        const tabs = document.querySelectorAll('.tab');
        const navItems = document.querySelectorAll('.nav-item');
        const adContainer = document.getElementById('ad-container');
        const adCountdownEl = document.getElementById('ad-countdown');
        const adCloseBtn = document.getElementById('ad-close');
        const referralLinkEl = document.getElementById('referral-link');
        const copyReferralBtn = document.getElementById('copy-referral');
        const referralStatusEl = document.getElementById('referral-status');
        
        // Telegram user data
        const telegramUsernameEl = document.getElementById('telegram-username');
        const telegramUseridEl = document.getElementById('telegram-userid');
        const completedTasksEl = document.getElementById('completed-tasks');
        const totalEarningsEl = document.getElementById('total-earnings');
        const joinDateEl = document.getElementById('join-date');
        
        // TON Connect
        let tonConnectUI;
        let wallet = null;

        // Initialize the wallet
        function initWallet() {
            // Initialize Telegram WebApp
            const tg = window.Telegram.WebApp;
            tg.ready();
            tg.expand();
            
            // Set Telegram user info
            if (tg.initDataUnsafe.user) {
                const user = tg.initDataUnsafe.user;
                state.telegramUser = {
                    id: user.id,
                    username: user.username || `user_${user.id}`,
                    firstName: user.first_name || "User",
                    lastName: user.last_name || ""
                };
            }
            
            // Update UI with Telegram user data
            telegramUsernameEl.textContent = state.telegramUser.username;
            telegramUseridEl.textContent = `ID: ${state.telegramUser.id}`;
            
            // Generate referral link
            const referralLink = `https://t.me/TonQashBot?start=ref_${state.telegramUser.id}`;
            referralLinkEl.value = referralLink;
            
            // Initialize TON Connect for different sections
            initTonConnect('ton-connect-main', 'main');
            initTonConnect('ton-connect-tasks', 'tasks');
            initTonConnect('ton-connect-account', 'account');
            
            // Add initial transactions
            setTimeout(() => {
                addTransaction('receive', 0.5, 'TON', 'Welcome Bonus');
                addTransaction('receive', 10, 'TQH', 'Registration Reward');
                loadingSpinner.style.display = 'none';
            }, 1500);
            
            updateBalanceDisplay();
            updatePriceDisplays();
            updateAccountInfo();
            setupEventListeners();
            updateAdTimer();
            updateDailyTimer();
        }

        // Initialize TonConnect
        function initTonConnect(elementId, context) {
            const tonConnect = new TON_CONNECT_UI.TonConnectUI({
                manifestUrl: 'https://jamladz.github.io/Home/tonconnect-manifest.json',
                buttonRootId: elementId,
                language: 'en'
            });

            tonConnect.onStatusChange(userWallet => {
                wallet = userWallet;
                state.walletConnected = !!wallet;
                
                if (wallet) {
                    // Update all wallet status indicators
                    document.querySelectorAll('.wallet-status').forEach(el => {
                        el.innerHTML = '<div class="wallet-connected">✅ Wallet Connected</div>';
                    });
                    
                    // Enable task buttons
                    document.getElementById('daily-reward-btn').disabled = false;
                    document.getElementById('watch-ad-btn').disabled = false;
                    
                    // Complete wallet connection task
                    if (!state.walletTaskCompleted) {
                        state.tqhBalance += 5;
                        state.completedTasks += 1;
                        state.totalEarnings += 5;
                        addTransaction('task', 5, 'TQH', 'Wallet Connection Reward');
                        updateBalanceDisplay();
                        updateAccountInfo();
                        state.walletTaskCompleted = true;
                    }
                } else {
                    document.getElementById('daily-reward-btn').disabled = true;
                    document.getElementById('watch-ad-btn').disabled = true;
                }
            });
            
            // Add status indicator
            const statusEl = document.createElement('div');
            statusEl.className = 'wallet-status';
            statusEl.innerHTML = state.walletConnected 
                ? '<div class="wallet-connected">✅ Wallet Connected</div>' 
                : '<div class="wallet-status-text">Connect your wallet</div>';
            document.getElementById(elementId).appendChild(statusEl);
        }

        // Update balance display
        function updateBalanceDisplay() {
            const activeCurrency = document.querySelector('.tab.active').dataset.currency;
            
            if (activeCurrency === 'ton') {
                balanceAmountEl.textContent = state.tonBalance.toFixed(2);
                balanceCurrencyEl.textContent = 'TON';
                balanceValueEl.textContent = (state.tonBalance * state.tonPrice).toFixed(2);
            } else {
                balanceAmountEl.textContent = state.tqhBalance.toFixed(2);
                balanceCurrencyEl.textContent = 'TQH';
                balanceValueEl.textContent = (state.tqhBalance * state.tqhPrice).toFixed(2);
            }
        }

        // Update price displays
        function updatePriceDisplays() {
            document.getElementById('ton-price').textContent = state.tonPrice.toFixed(2);
            document.getElementById('tqh-price').textContent = state.tqhPrice.toFixed(2);
        }

        // Update account info
        function updateAccountInfo() {
            completedTasksEl.textContent = state.completedTasks;
            totalEarningsEl.textContent = `${state.totalEarnings.toFixed(2)} TQH`;
            
            const today = new Date();
            const joinDate = new Date(today);
            joinDate.setDate(today.getDate() - 7);
            joinDateEl.textContent = joinDate.toLocaleDateString('en-US', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });
        }

        // Update transactions list
        function updateTransactions() {
            if (state.transactions.length === 0) {
                transactionsList.innerHTML = `
                    <div class="transaction">
                        <div class="transaction-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="transaction-details">
                            <div class="transaction-title">Welcome to TonQash Wallet</div>
                            <div class="transaction-date">Start your first transactions</div>
                        </div>
                    </div>
                `;
                return;
            }
            
            transactionsList.innerHTML = '';
            
            state.transactions.slice().reverse().forEach(transaction => {
                const transactionEl = document.createElement('div');
                transactionEl.className = 'transaction fade-in';
                
                let iconClass, amountClass, icon;
                
                if (transaction.type === 'receive') {
                    iconClass = 'receive';
                    amountClass = 'receive';
                    icon = '<i class="fas fa-arrow-down"></i>';
                } else if (transaction.type === 'send') {
                    iconClass = 'send';
                    amountClass = 'send';
                    icon = '<i class="fas fa-arrow-up"></i>';
                } else if (transaction.type === 'convert') {
                    iconClass = 'task';
                    amountClass = 'task';
                    icon = '<i class="fas fa-exchange-alt"></i>';
                } else if (transaction.type === 'task') {
                    iconClass = 'task';
                    amountClass = 'task';
                    icon = '<i class="fas fa-trophy"></i>';
                } else if (transaction.type === 'daily') {
                    iconClass = 'task';
                    amountClass = 'task';
                    icon = '<i class="fas fa-calendar-check"></i>';
                }
                
                transactionEl.innerHTML = `
                    <div class="transaction-icon ${iconClass}">
                        ${icon}
                    </div>
                    <div class="transaction-details">
                        <div class="transaction-title">${transaction.title}</div>
                        <div class="transaction-date">${transaction.date}</div>
                    </div>
                    <div class="transaction-amount ${amountClass}">${transaction.amount > 0 ? '+' : ''}${transaction.amount.toFixed(2)} ${transaction.currency}</div>
                `;
                
                transactionsList.appendChild(transactionEl);
            });
        }

        // Add transaction
        function addTransaction(type, amount, currency, title) {
            const now = new Date();
            const dateStr = now.toLocaleDateString('en-US', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            }) + ' - ' + now.toLocaleTimeString('en-US', {
                hour: '2-digit',
                minute: '2-digit'
            });
            
            state.transactions.push({
                type,
                amount,
                currency,
                title,
                date: dateStr
            });
            
            // Save to localStorage
            localStorage.setItem('tonqash_transactions', JSON.stringify(state.transactions));
            
            updateTransactions();
        }

        // Update ad timer
        function updateAdTimer() {
            const now = Date.now();
            const timeSinceLastAd = now - state.lastAdTime;
            const cooldown = 30 * 1000; // 30 seconds
            const remaining = Math.max(0, cooldown - timeSinceLastAd);
            
            const timerEl = document.getElementById('ad-timer');
            const watchBtn = document.getElementById('watch-ad-btn');
            
            if (remaining > 0) {
                const seconds = Math.ceil(remaining / 1000);
                timerEl.textContent = `Available in: ${seconds} seconds`;
                watchBtn.classList.add('disabled');
            } else {
                timerEl.textContent = '';
                watchBtn.classList.remove('disabled');
            }
        }

        // Update daily reward timer
        function updateDailyTimer() {
            const now = Date.now();
            const timeSinceLastClaim = now - state.lastDailyClaim;
            const cooldown = 24 * 60 * 60 * 1000; // 24 hours
            const remaining = Math.max(0, cooldown - timeSinceLastClaim);
            
            const timerEl = document.getElementById('daily-timer');
            const claimBtn = document.getElementById('daily-reward-btn');
            
            if (remaining > 0) {
                const hours = Math.floor(remaining / (1000 * 60 * 60));
                const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                timerEl.textContent = `Available in: ${hours}h ${minutes}m`;
                claimBtn.classList.add('disabled');
            } else {
                timerEl.textContent = '';
                claimBtn.classList.remove('disabled');
            }
        }

        // Show ad
        function showAd() {
            adContainer.style.display = 'flex';
            let count = 30;
            
            adCountdownEl.textContent = count;
            
            const countdown = setInterval(() => {
                count--;
                adCountdownEl.textContent = count;
                
                if (count <= 0) {
                    clearInterval(countdown);
                    completeAd();
                }
            }, 1000);
        }

        // Complete ad watching
        function completeAd() {
            adContainer.style.display = 'none';
            state.lastAdTime = Date.now();
            state.tqhBalance += 1;
            state.totalEarnings += 1;
            state.completedTasks += 1;
            
            addTransaction('task', 1, 'TQH', 'Ad Reward');
            updateBalanceDisplay();
            updateAccountInfo();
            updateAdTimer();
            
            alert('Congratulations! You earned 1 TQH from watching the ad');
        }

        // Send payment for daily reward
        async function sendDailyPayment() {
            if (!wallet) {
                alert('Please connect your wallet first');
                return;
            }

            const tx = {
                validUntil: Math.floor(Date.now() / 1000) + 600,
                messages: [
                    {
                        address: 'UQCTZAMbXoN5T43K9gJXH8GYWBmIstXrUrdoV9kv3btN1Ad3',
                        amount: '100000000' // 0.1 TON
                    }
                ]
            };

            try {
                // Show processing state
                const btn = document.getElementById('daily-reward-btn');
                btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                btn.disabled = true;
                
                // Simulate processing delay
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                state.lastDailyClaim = Date.now();
                state.tqhBalance += 20;
                state.completedTasks += 1;
                state.totalEarnings += 20;
                
                addTransaction('daily', 20, 'TQH', 'Daily Reward');
                updateBalanceDisplay();
                updateAccountInfo();
                updateDailyTimer();
                
                btn.innerHTML = 'Claim Reward';
                btn.disabled = false;
                
                alert('Payment successful! You received 20 TQH as a daily reward');
            } catch (error) {
                alert(`Payment failed: ${error.message}`);
                btn.innerHTML = 'Claim Reward';
                btn.disabled = false;
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            // Currency tabs
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    updateBalanceDisplay();
                });
            });
            
            // Navigation
            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    navItems.forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    
                    const page = item.dataset.page;
                    
                    if (page === 'home') {
                        document.querySelector('.transactions').style.display = 'block';
                        tasksContainer.style.display = 'none';
                        accountContainer.style.display = 'none';
                    } else if (page === 'wallet') {
                        document.querySelector('.transactions').style.display = 'block';
                        tasksContainer.style.display = 'none';
                        accountContainer.style.display = 'none';
                    } else if (page === 'tasks') {
                        document.querySelector('.transactions').style.display = 'none';
                        tasksContainer.style.display = 'block';
                        accountContainer.style.display = 'none';
                    } else if (page === 'account') {
                        document.querySelector('.transactions').style.display = 'none';
                        tasksContainer.style.display = 'none';
                        accountContainer.style.display = 'block';
                    }
                });
            });
            
            // Watch ad button
            document.getElementById('watch-ad-btn').addEventListener('click', () => {
                const now = Date.now();
                const timeSinceLastAd = now - state.lastAdTime;
                const cooldown = 30 * 1000; // 30 seconds
                
                if (timeSinceLastAd < cooldown) {
                    alert('Please wait 30 seconds between watching ads');
                    return;
                }
                
                showAd();
            });
            
            // Daily reward button
            document.getElementById('daily-reward-btn').addEventListener('click', () => {
                const now = Date.now();
                const timeSinceLastClaim = now - state.lastDailyClaim;
                const cooldown = 24 * 60 * 60 * 1000; // 24 hours
                
                if (timeSinceLastClaim < cooldown) {
                    alert('You can claim the daily reward once every 24 hours');
                    return;
                }
                
                sendDailyPayment();
            });
            
            // Ad close button
            adCloseBtn.addEventListener('click', () => {
                adContainer.style.display = 'none';
                alert('You will not receive the reward as you did not complete watching the ad');
            });
            
            // Copy referral link
            copyReferralBtn.addEventListener('click', () => {
                navigator.clipboard.writeText(referralLinkEl.value);
                referralStatusEl.textContent = 'Link copied!';
                setTimeout(() => {
                    referralStatusEl.textContent = 'Calculating...';
                }, 2000);
            });
        }

        // Simulate price changes
        function simulatePriceChanges() {
            // TON price simulation
            const tonVariation = (Math.random() - 0.5) * 0.2;
            state.tonPrice += tonVariation;
            state.tonPrice = Math.max(2.5, Math.min(4.0, state.tonPrice));
            
            const tonChangeEl = document.getElementById('ton-change');
            tonChangeEl.textContent = (tonVariation > 0 ? '+' : '') + (tonVariation * 100 / state.tonPrice).toFixed(2);
            tonChangeEl.className = tonVariation >= 0 ? 'price-change positive' : 'price-change negative';
            
            // TQH price simulation
            const tqhVariation = (Math.random() - 0.5) * 0.1;
            state.tqhPrice += tqhVariation;
            state.tqhPrice = Math.max(0.15, Math.min(0.35, state.tqhPrice));
            
            const tqhChangeEl = document.getElementById('tqh-change');
            tqhChangeEl.textContent = (tqhVariation > 0 ? '+' : '') + (tqhVariation * 100 / state.tqhPrice).toFixed(2);
            tqhChangeEl.className = tqhVariation >= 0 ? 'price-change positive' : 'price-change negative';
            
            updatePriceDisplays();
            updateBalanceDisplay();
        }

        // Initialize the wallet when page loads
        window.addEventListener('DOMContentLoaded', () => {
            // Load transactions from localStorage if available
            const savedTransactions = localStorage.getItem('tonqash_transactions');
            if (savedTransactions) {
                state.transactions = JSON.parse(savedTransactions);
                updateTransactions();
            }
            
            initWallet();
            
            // Start price simulation
            setInterval(simulatePriceChanges, 10000);
            
            // Update timers every second
            setInterval(() => {
                updateAdTimer();
                updateDailyTimer();
            }, 1000);
            
            // Initial price update
            simulatePriceChanges();
        });
    </script>
</body>
</html>
